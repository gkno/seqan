#include <iostream>

#include "pizzachili_api.h"

using namespace std;
using namespace seqan;

#define MAKE_TEST(which, disp, build_options) \
    inline void test_##which() { \
        cout << disp " test" << endl; \
        impl::index_t index; \
        impl::error_t e = PizzaChiliApi##which::build_index( \
            (unsigned char*)("Hallo, Welt!"), 11, build_options, &index \
        ); \
        \
        cout << e << ": " << PizzaChiliApi##which::error_index(e) << endl; \
        \
        if (e != 0) return; \
        \
        impl::uchar_t* text; \
        impl::ulong_t len; \
        e = PizzaChiliApi##which::extract(index, 0, 11, &text, &len); \
        \
        if (e != 0) { \
            cout << e << ": " << PizzaChiliApi##which::error_index(e) << \
                endl << endl; \
            return; \
        } \
        cout << text << " (" << len << ")" << endl; \
        free(text); \
        e = PizzaChiliApi##which::free_index(index); \
        if (e != 0) \
            cout << e << ": " << PizzaChiliApi##which::error_index(e) << endl; \
        cout << endl; \
    }

MAKE_TEST(AF, "AF", "")
MAKE_TEST(SA, "SA", "copy_text")
MAKE_TEST(SSA, "SSA", "")

int main() {
    test_AF();
    test_SA();
    test_SSA();
}
